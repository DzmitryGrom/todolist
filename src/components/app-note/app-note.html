<template id="appDay">
  <style>
    @import "/components/app-note/app-note.css";
    :host {
      position: absolute;
      top: 16px;
      left: 16px;
      right: 16px;
      z-index: 2;
  </style>
  <div class="note__inner">
    <span class="note__icon-close icon-close">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
        <path fill="#556066" d="M6.33048947,7.0021478 L0.133497402,13.2424335 C-0.0386655729,13.4157993 -0.0386655729,13.696665 0.133497402,13.8700308 C0.219469511,13.9568238 0.33234892,14 0.445009571,14 C0.55788898,14 0.670549631,13.9568238 0.756521739,13.8700308 L7.00010938,7.58282392 L13.243697,13.8700308 C13.3298879,13.9568238 13.4425485,14 13.5552092,14 C13.6678698,14 13.7807492,13.9568238 13.8667214,13.8700308 C14.0388843,13.696665 14.0388843,13.4157993 13.8667214,13.2424335 L7.66994804,7.0021478 L13.8708778,0.757456316 C14.0430407,0.584090569 14.0430407,0.303224842 13.8708778,0.129859095 C13.6987148,-0.043286365 13.4197976,-0.043286365 13.2478534,0.129859095 L7.00032814,6.42147167 L0.752146568,0.130079382 C0.579983593,-0.0430660782 0.301285206,-0.0430660782 0.129122231,0.130079382 C-0.0430407438,0.303445129 -0.0430407438,0.584310856 0.129122231,0.757676603 L6.33048947,7.0021478 Z" transform="translate(5 5)"></path>
      </svg>
    </span>
    <form>
      <div class="note__row">
        <label class="note__row-label">Категория или цель</label>
        <input type="text" class="note__input">
      </div>
      <div class="note__row">
        <label class="note__row-label">Заметка</label>
        <textarea style='max-height: 300px' class="note__textarea"></textarea>
      </div>
      <div class="note__row">
        <label class="note__row-label">Статус</label>
        <div class="note__info">
          <div class="icon-info">
            <div class="note__tooltip">
              Выберите статус, если статус не выбран он будет считаться как "Не выполненно"
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
              <path fill="#9AA5AB" fill-rule="evenodd" d="M13,15.5 C13.1354173,15.5 13.2526037,15.5494787 13.3515625,15.6484375 C13.4505213,15.7473963 13.5,15.8645827 13.5,16 C13.5,16.1354173 13.4505213,16.2526037 13.3515625,16.3515625 C13.2526037,16.4505213 13.1354173,16.5 13,16.5 L11,16.5 C10.8645827,16.5 10.7473963,16.4505213 10.6484375,16.3515625 C10.5494787,16.2526037 10.5,16.1354173 10.5,16 C10.5,15.8645827 10.5494787,15.7473963 10.6484375,15.6484375 C10.7473963,15.5494787 10.8645827,15.5 11,15.5 L11.5,15.5 L11.5,11.5 L11,11.5 C10.8645827,11.5 10.7473963,11.4505213 10.6484375,11.3515625 C10.5494787,11.2526037 10.5,11.1354173 10.5,11 C10.5,10.8645827 10.5494787,10.7473963 10.6484375,10.6484375 C10.7473963,10.5494787 10.8645827,10.5 11,10.5 L12,10.5 C12.1354173,10.5 12.2526037,10.5494787 12.3515625,10.6484375 C12.4505213,10.7473963 12.5,10.8645827 12.5,11 L12.5,15.5 L13,15.5 Z M12,9.5 C11.7187486,9.5 11.4817718,9.4036468 11.2890625,9.2109375 C11.0963532,9.0182282 11,8.78125141 11,8.5 C11,8.21874859 11.0963532,7.9817718 11.2890625,7.7890625 C11.4817718,7.5963532 11.7187486,7.5 12,7.5 C12.2812514,7.5 12.5182282,7.5963532 12.7109375,7.7890625 C12.9036468,7.9817718 13,8.21874859 13,8.5 C13,8.78125141 12.9036468,9.0182282 12.7109375,9.2109375 C12.5182282,9.4036468 12.2812514,9.5 12,9.5 Z M12,4 C13.1041722,4 14.1432243,4.20833125 15.1171875,4.625 C16.0911507,5.04166875 16.9401005,5.61197555 17.6640625,6.3359375 C18.3880245,7.05989945 18.9583313,7.9088493 19.375,8.8828125 C19.7916687,9.8567757 20,10.8958278 20,12 C20,13.1041722 19.7916687,14.1432243 19.375,15.1171875 C18.9583313,16.0911507 18.3880245,16.9401005 17.6640625,17.6640625 C16.9401005,18.3880245 16.0911507,18.9583313 15.1171875,19.375 C14.1432243,19.7916687 13.1041722,20 12,20 C10.8958278,20 9.8567757,19.7916687 8.8828125,19.375 C7.9088493,18.9583313 7.05989945,18.3880245 6.3359375,17.6640625 C5.61197555,16.9401005 5.04166875,16.0911507 4.625,15.1171875 C4.20833125,14.1432243 4,13.1041722 4,12 C4,10.8958278 4.20833125,9.8567757 4.625,8.8828125 C5.04166875,7.9088493 5.61197555,7.05989945 6.3359375,6.3359375 C7.05989945,5.61197555 7.9088493,5.04166875 8.8828125,4.625 C9.8567757,4.20833125 10.8958278,4 12,4 Z M12,19.015625 C12.9687548,19.015625 13.8775999,18.830731 14.7265625,18.4609375 C15.5755251,18.091144 16.315101,17.5885448 16.9453125,16.953125 C17.575524,16.3177052 18.075519,15.5755251 18.4453125,14.7265625 C18.815106,13.8775999 19,12.9687548 19,12 C19,11.0312452 18.815106,10.1224001 18.4453125,9.2734375 C18.075519,8.42447492 17.575524,7.68489898 16.9453125,7.0546875 C16.315101,6.42447602 15.5755251,5.92448102 14.7265625,5.5546875 C13.8775999,5.18489398 12.9687548,5 12,5 C11.0312452,5 10.1224001,5.18489398 9.2734375,5.5546875 C8.42447492,5.92448102 7.68489898,6.42447602 7.0546875,7.0546875 C6.42447602,7.68489898 5.92448102,8.42447492 5.5546875,9.2734375 C5.18489398,10.1224001 5,11.0312452 5,12 C5,12.9687548 5.18489398,13.8775999 5.5546875,14.7265625 C5.92448102,15.5755251 6.42447602,16.3177052 7.0546875,16.953125 C7.68489898,17.5885448 8.42447492,18.091144 9.2734375,18.4609375 C10.1224001,18.830731 11.0312452,19.015625 12,19.015625 Z"></path>
            </svg>
          </div>
        </div>
        <select class="note__select">
          <option disabled="" selected="selected">Выберите статус</option>
          <option value="">Выполненно</option>
          <option value="">Не выполненно</option>
        </select>
      </div>
      <button class="note__btn-send">OK</button>
      <span class="note__btn-delete">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
              <path fill="#556066" fill-rule="evenodd" d="M18.015625,6.484375 C18.1510423,6.484375 18.2682287,6.53385367 18.3671875,6.6328125 C18.4661463,6.73177133 18.515625,6.84895766 18.515625,6.984375 C18.515625,7.11979234 18.4661463,7.23697867 18.3671875,7.3359375 C18.2682287,7.43489633 18.1510423,7.484375 18.015625,7.484375 L17.328125,7.484375 L16.15625,19.046875 C16.1354166,19.3177097 16.0234385,19.5468741 15.8203125,19.734375 C15.6171865,19.9218759 15.3802097,20.015625 15.109375,20.015625 L8.890625,20.015625 C8.61979031,20.015625 8.38281352,19.9218759 8.1796875,19.734375 C7.97656148,19.5468741 7.85937516,19.3177097 7.828125,19.046875 L6.671875,7.484375 L5.984375,7.484375 C5.84895766,7.484375 5.73177133,7.43489633 5.6328125,7.3359375 C5.53385367,7.23697867 5.484375,7.11979234 5.484375,6.984375 C5.484375,6.84895766 5.53385367,6.73177133 5.6328125,6.6328125 C5.73177133,6.53385367 5.84895766,6.484375 5.984375,6.484375 L9.5,6.484375 L9.5,5.125 C9.5,4.80208172 9.61458219,4.53125109 9.84375,4.3125 C10.0729178,4.09374891 10.3437484,3.984375 10.65625,3.984375 L13.34375,3.984375 C13.6562516,3.984375 13.9270822,4.09374891 14.15625,4.3125 C14.3854178,4.53125109 14.5,4.80208172 14.5,5.125 L14.5,6.484375 L18.015625,6.484375 Z M10.5,5.125 L10.5,6.484375 L13.5,6.484375 L13.5,5.125 C13.5,5.08333312 13.4843752,5.04687516 13.453125,5.015625 C13.4218748,4.98437484 13.3854169,4.96875 13.34375,4.96875 L10.65625,4.96875 C10.6145831,4.96875 10.5781252,4.98437484 10.546875,5.015625 C10.5156248,5.04687516 10.5,5.08333312 10.5,5.125 Z M15.171875,18.953125 L16.3125,7.484375 L7.6875,7.484375 L8.828125,18.953125 C8.828125,18.9635417 8.83593742,18.9765624 8.8515625,18.9921875 C8.86718758,19.0078126 8.88020828,19.015625 8.890625,19.015625 L15.109375,19.015625 C15.1197917,19.015625 15.1328124,19.0104167 15.1484375,19 C15.1640626,18.9895833 15.171875,18.9739584 15.171875,18.953125 Z"></path>
          </svg>
        </span>
    </form>
  </div>
</template>

<script>
  (() => {
    const template = document.currentScript.ownerDocument.querySelector('template');
    appNoteFactory.$inject = ['app.main.model.view', 'app.main.util.Emitter'];
    Core.module('app.main').component('app.main.component.appNote', appNoteFactory);
    function appNoteFactory(viewModel, Emitter) {

      class AppNote extends HTMLElement {

        constructor() {
          super();
          const shadowRoot = this.attachShadow({mode: 'open'});
          this.rootElement = template.content.cloneNode(true);
          this.shadowRoot.appendChild(this.rootElement);

          let  editor = shadowRoot.querySelector('textarea'),
               btnClose = shadowRoot.querySelector('.note__icon-close'),
               emitter = new Emitter();

          editor.addEventListener('keydown', autosize);
         // btnClose.addEventListener('click', closeNote);

          function autosize(){
            var el = this;
            setTimeout(function(){
              el.style.cssText = 'height:auto;';
              el.style.cssText = 'height:' + el.scrollHeight + 'px';
            },0);
          }

          this.prevActive = null;

          btnClose.addEventListener('click', event => {
              viewModel.setMainViewName();
          });

          shadowRoot.addEventListener('click', (event) => {
            let target = event.target;
            if(target.tagName === 'SPAN') {
              this.remove();
            }
          });

          viewModel.subscribeMainViewName((viewName) => {
            this.prevActive = true;
          }, true);
        }
//        disconnectedCallback() {
//          console.log('hi');
//        }

      }
      customElements.define('app-note', AppNote);
      return AppNote;
    }
  })();
</script>

